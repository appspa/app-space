import{n as l,v as g,u as w,i as b,a as y,r as S,d as I,g as C,b as A,c as $,e as k,f as c,h as x}from"./index.4d4590a9.js";import{U as V}from"./uploadApp.488a428b.js";import{V as v}from"./vue-qr.4cc29d34.js";import L from"./appSetting.2e772d21.js";var D=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"editorVersion-wrapper",on:{click:e.cancel}},[t("transition",{attrs:{name:"fadeRight"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:this.show,expression:"this.show"}],staticClass:"editorVersion-content",on:{click:function(s){return s.stopPropagation(),e.clickContent.apply(null,arguments)}}},[t("div",{staticClass:"top"},[t("i",{staticClass:"icon-ic_editor"}),t("span",[e._v("\u7248\u672C\u7F16\u8F91")])]),t("el-form",{attrs:{"label-position":"left",labelWidth:"110px"}},[this.appInfo.platform!="rn"?t("el-form-item",{attrs:{label:"\u7248\u672C\u4FE1\u606F",required:""}},[t("p",{staticClass:"versionInput"},[e._v(e._s(this.versionInfo.versionName+" (".concat(this.versionInfo.versionCode,")")))])]):e._e(),this.appInfo.platform=="rn"?t("el-form-item",{attrs:{label:"\u7248\u672C\u4FE1\u606F",required:""}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.appVersion,expression:"appVersion"}],staticStyle:{width:"72px","border-bottom":"solid 1px #eee","text-align":"center"},attrs:{type:"text"},domProps:{value:e.appVersion},on:{input:function(s){s.target.composing||(e.appVersion=s.target.value)}}}),t("el-tooltip",{staticStyle:{"margin-left":"20px"},attrs:{placement:"right-end"}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("span",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(e.appVersionDes))])]),t("i",{staticClass:"el-icon-warning-outline"})])],1):e._e(),this.appInfo.platform!=="rn"?t("el-form-item",{attrs:{label:"BundleId"}},[t("p",{staticClass:"versionInput"},[e._v(e._s(this.versionInfo.bundleId))])]):e._e(),t("el-form-item",{attrs:{label:"\u6587\u4EF6\u5927\u5C0F"}},[t("p",{staticClass:"versionInput"},[e._v(e._s((this.versionInfo.size/1024/1024).toFixed(2))+"M")])]),t("el-form-item",{attrs:{label:"\u662F\u5426\u53D1\u5E03"}},[t("el-radio",{attrs:{label:!0},model:{value:e.active,callback:function(s){e.active=s},expression:"active"}},[e._v("\u662F")]),t("el-radio",{attrs:{label:!1},model:{value:e.active,callback:function(s){e.active=s},expression:"active"}},[e._v("\u5426")])],1),t("el-form-item",{attrs:{label:"\u4E0B\u8F7D\u6B21\u6570"}},[t("el-radio",{attrs:{label:!1},model:{value:e.grayScaleLimit,callback:function(s){e.grayScaleLimit=s},expression:"grayScaleLimit"}},[e._v("\u4E0D\u9650\u5236")]),t("el-radio",{attrs:{label:!0},model:{value:e.grayScaleLimit,callback:function(s){e.grayScaleLimit=s},expression:"grayScaleLimit"}},[e._v("\u9650\u5236")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.grayScaleSize,expression:"grayScaleSize"}],staticStyle:{width:"72px","border-bottom":"solid 1px #eee","text-align":"center"},attrs:{type:"text"},domProps:{value:e.grayScaleSize},on:{input:function(s){s.target.composing||(e.grayScaleSize=s.target.value)}}}),t("p",{staticStyle:{display:"inline-block",color:"#354052"}},[e._v("\u6B21")]),t("p",{staticClass:"versiondownload",staticStyle:{display:"inline-block","margin-left":"10px",color:"#354052"}},[e._v("(\u5DF2\u4E0B\u8F7D"+e._s(this.versionInfo.downloadCount)+"\u6B21)")])],1),t("el-form-item",{attrs:{label:"\u66F4\u65B0\u65B9\u5F0F"}},[t("el-radio",{attrs:{label:"normal"},model:{value:e.updateType,callback:function(s){e.updateType=s},expression:"updateType"}},[e._v("\u666E\u901A\u66F4\u65B0")]),t("el-radio",{attrs:{label:"silent"},model:{value:e.updateType,callback:function(s){e.updateType=s},expression:"updateType"}},[e._v("\u9759\u9ED8\u66F4\u65B0")]),t("el-radio",{attrs:{label:"force"},model:{value:e.updateType,callback:function(s){e.updateType=s},expression:"updateType"}},[e._v("\u5F3A\u5236\u66F4\u65B0")])],1),t("el-form-item",{attrs:{label:"\u66F4\u65B0\u65E5\u5FD7"}},[t("p",{staticClass:"textareacount"},[e._v(e._s(this.updateContent.length)+"/100")]),t("el-input",{staticClass:"editorVersion-updatatextarea",attrs:{type:"textarea",placeholder:"\u66F4\u65B0\u65E5\u5FD7",maxlength:100},model:{value:e.updateContent,callback:function(s){e.updateContent=s},expression:"updateContent"}})],1)],1),t("el-button",{staticClass:"elbutton-style sureBtn",attrs:{round:""},on:{click:e.sure}},[e._v("\u786E\u8BA4")]),t("el-button",{staticClass:"elbutton-style cancelBtn",attrs:{round:""},on:{click:e.cancel}},[e._v("\u53D6\u6D88")])],1)])],1)},T=[];const U={props:{versionInfo:{type:Object},appInfo:{type:Object}},data(){return{show:!1,updateContent:"",downloadUrl:"",updateType:"normal",active:!1,grayScaleLimit:!1,grayScaleSize:0,appVersion:"",appVersionDes:"-  `*` \u5339\u914D\u6240\u6709\u7248\u672C \n-  `1.2.3` \u5339\u914D\u7279\u5B9A\u7248\u672C`1.2.3`\n-  `1.2`/`1.2.*` \u5339\u914D\u6240\u67091.2\u8865\u4E01\u7248\u672C \n-  `>=1.2.3<1.3.7`\n-  `~1.2.3` \u5339\u914D`>=1.2.3<1.3.0`\n-  `^1.2.3` \u5339\u914D`>=1.2.3<2.0.0`"}},created(){setTimeout(()=>{console.log(this.versionInfo),console.log("this.appInfo",this.appInfo),this.show=!0,this.downloadUrl=this.versionInfo.installUrl,this.versionInfo.changeLog&&(this.updateContent=this.versionInfo.changeLog),this.updateType=this.versionInfo.updateMode,this.appVersion=this.versionInfo.appVersion,this.active=this.versionInfo.active||!1,this.grayScaleLimit=this.versionInfo.grayScaleLimit||!1,this.grayScaleSize=this.versionInfo.grayScaleSize||0},200)},methods:{cancel(){this.show=!1,setTimeout(()=>{this.$emit("cancel")},500)},sure(){let a={showOnDownloadPage:this.showOnDownLoadPage,changeLog:this.updateContent,active:this.active,updateMode:this.updateType,grayScaleSize:this.grayScaleSize,grayScaleLimit:this.grayScaleLimit};if(this.appInfo.platform=="rn"){if(!this.appVersion){this.$message.error("\u8BF7\u8F93\u5165\u7248\u672C\u4FE1\u606F");return}if(!g(this.appVersion)){this.$message.error("\u7248\u672C\u4FE1\u606F\u683C\u5F0F\u4E0D\u6B63\u786E");return}a.appVersion=this.appVersion}w(this.appInfo._id,this.versionInfo._id,a).then(e=>{console.log(e),this.$message.success(e.message),this.$emit("updateSuccess")},e=>{})},clickContent(){},getDownLoadCount(a){return a||0},getAllowDownLoadCount(a){return a&&a.downloadCountLimit?a.downloadCountLimit:"\u4E0D\u9650"}}},d={};var E=l(U,D,T,!1,z,null,null,null);function z(a){for(let e in d)this[e]=d[e]}var _=function(){return E.exports}(),M=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("div",{staticClass:"detail-header"},[t("div",{staticClass:"detail-header-top"},[t("div",{staticClass:"leftWrapper"},[t("vue-qr",{staticClass:"qrcodeImg",attrs:{autoColor:!1,colorDark:"#354052",text:e.getDownLoadUrl(),margin:20}}),t("div",{staticClass:"title"},[e._v("\u4E0B\u8F7D\u5730\u5740")]),t("a",{attrs:{target:"_blank",href:e.getDownLoadUrl()}},[t("span",{staticClass:"url"},[e._v(e._s(this.getDownLoadUrl()))])])],1),t("div",{staticClass:"rightWrapper",staticStyle:{"z-index":"1"}},[t("el-button",{staticClass:"uploadWrapper button-style-main"},[t("i",{staticClass:"icon-ic_upload"}),e._v("\u4E0A\u4F20\u65B0\u7248\u672C")]),t("input",{ref:"referenceUpload",staticStyle:{position:"absolute",top:"36px",left:"0px",width:"144px",height:"48px",opacity:"0",cursor:"pointer"},attrs:{title:"\u4E0A\u4F20\u5E94\u7528",accept:this.acceptType,type:"file"},on:{change:e.referenceUpload}}),t("button",{staticClass:"preview button-style-border",on:{click:e.clickPreviewBtn}},[e._v("\u9884\u89C8")]),t("button",{staticClass:"delete button-style-border",on:{click:e.deleteApp}},[e._v("\u5220\u9664")]),t("div",{staticStyle:{width:"120px",height:"16px","background-color":"#229FFC",position:"absolute",top:"68px",left:"36px","border-radius":"10px",filter:"blur(10px)","z-index":"-1"}})],1)])]),this.showUploadView?t("uploadApp",{attrs:{appInfo:this.appInfo,appFile:this.file},on:{closeUpload:e.closeUploadMethod,uploadSuccess:e.uploadSuccessMethod}}):e._e(),this.showEditorVersion?t("editorVersion",{attrs:{versionInfo:this.versionInfo,appInfo:this.appInfo},on:{cancel:e.cancel,updateSuccess:e.updateSuccess}}):e._e()],1)},B=[];const P={props:{appInfo:{type:Object}},data(){return{showUploadView:!1,file:FileList,showEditorVersion:!1,versionInfo:{},acceptType:""}},components:{VueQr:v,editorVersion:_,UploadApp:V},watch:{appInfo(a){a.platform=="ios"?this.acceptType=".ipa":a.platform=="android"?this.acceptType=".apk":a.platform=="rn"&&(this.acceptType=".zip"),console.log("acceptType",this.acceptType)}},created(){this.$nextTick(()=>{})},methods:{getDownLoadUrl(){return window.location.origin+"/"+this.appInfo.shortUrl},clickPreviewBtn(){const{href:a}=this.$router.resolve({name:"AppPreView",path:"/",params:{id:this.appInfo.shortUrl}});window.open(a,"_blank")},getIconUrl(){return this.appInfo.icon?this.appInfo.icon:this.appInfo.platform=="ios"?b:this.appInfo.platform=="android"?y:this.appInfo.platform=="rn"?S:""},getAppType(){return this.appInfo.appLevel==="enterprise"?"\u4F01\u4E1A\u7248":this.appInfo.appLevel==="develop"?"\u5185\u6D4B\u7248":this.appInfo.appLevel==="appstore"?"AppStore\u7248":""},updateSuccess(){this.showEditorVersion=!1,this.$emit("updateAppInfoSuccess"),this.bus.$emit("uploadSuccess")},cancel(){this.showEditorVersion=!1},referenceUpload(a){this.file=a.target.files,console.log(this.file),a.target.files.length>0&&(this.showUploadView=!0)},deleteApp(a){this.$confirm("\u786E\u8BA4\u5220\u9664\uFF1F").then(e=>{I(this.appInfo._id).then(o=>{this.$message.success("\u5220\u9664\u6210\u529F"),this.$router.go(-1)},o=>{this.$message.error(o)})}).catch(e=>{})},closeUploadMethod(){this.showUploadView=!1,this.$refs.referenceUpload.value=""},uploadSuccessMethod(a){this.showUploadView=!1,this.showEditorVersion=!0,this.$refs.referenceUpload.value="",this.versionInfo=a.data,this.bus.$emit("uploadSuccess"),this.bus.$emit("refreshAppList"),this.bus.$emit("refreshAppInfo")}}},u={};var j=l(P,M,B,!1,N,null,null,null);function N(a){for(let e in u)this[e]=u[e]}var F=function(){return j.exports}(),W=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"appVersion-wrapper"},[this.dataArr.length>0?t("div",[e._m(0),t("el-table",{staticClass:"version-table",staticStyle:{width:"100%","box-sizing":"border-box"},attrs:{data:e.dataArr,stripe:"",border:!1}},[t("el-table-column",{staticClass:"version-table-one",attrs:{width:"120",label:"\u6FC0\u6D3B",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{class:e.getIconClass(s.row)})]}}],null,!1,2782388939)}),t("el-table-column",{attrs:{width:"200",align:"center",label:"\u7248\u672C"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-dropdown",[t("div",[t("span",[e._v(e._s(e.getVersion(s.row)))]),t("i",{staticClass:"el-icon-arrow-down",staticStyle:{color:"#606266","margin-left":"5px"}})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("vue-qr",{attrs:{autoColor:!1,colorDark:"#354052",text:s.row.installUrl,margin:20}})],1)],1)]}}],null,!1,2318266125)}),t("el-table-column",{attrs:{align:"center",label:"\u66F4\u65B0\u65F6\u95F4",width:"170"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("p",{domProps:{innerHTML:e._s(e.getCreatTime(s.row.uploadAt))}})]}}],null,!1,320135178)}),t("el-table-column",{attrs:{align:"center",label:"\u66F4\u65B0\u65B9\u5F0F",width:"170"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{staticStyle:{color:"#9B9B9B",display:"inline-block"},domProps:{innerHTML:e._s(e.getUpdateMode(s.row.updateMode))}})]}}],null,!1,3294373045)}),t("el-table-column",{attrs:{align:"center",label:"\u6587\u4EF6\u5927\u5C0F",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("p",{domProps:{innerHTML:e._s(e.getAppSize(s.row.size))}})]}}],null,!1,3261518697)}),t("el-table-column",{attrs:{align:"center",label:"\u4E0B\u8F7D\u6B21\u6570",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{staticStyle:{color:"#9B9B9B",display:"inline-block"},domProps:{innerHTML:e._s(e.getAllowDownLoadCount(s.row))}})]}}],null,!1,3473435125)}),t("el-table-column",{attrs:{prop:"changeLog",label:"\u66F4\u65B0\u65E5\u5FD7"}}),t("el-table-column",{attrs:{label:"\u53D1\u5E03\u4EBA",width:"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){var n=s.row;return[t("div",[e._v(e._s(n.uploader))])]}}],null,!1,938753351)}),t("el-table-column",{attrs:{label:"\u64CD\u4F5C",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("button",{staticClass:"appversion-elButton",on:{click:function(r){return e.releaseApp(s.row)}}},[t("i",{staticClass:"icon-ic_overview"})]),t("button",{staticClass:"appversion-elButton",on:{click:function(r){return e.clickDownLoad(s.row)}}},[t("i",{staticClass:"icon-ic_download"})]),t("button",{staticClass:"appversion-elButton",on:{click:function(r){return e.clickEditor(s.row)}}},[t("i",{staticClass:"icon-ic_edit"})]),t("button",{staticClass:"appversion-elButton",on:{click:function(r){return e.clickDelete(s.row)}}},[t("i",{staticClass:"icon-ic_delete"})])]}}],null,!1,1068177132)})],1)],1):e._e(),t("div",{staticClass:"appVersion-footerWrapper"},[t("div",{staticClass:"totalWrapper"},[e._m(1),t("p",[e._v("\u603B\u4E0B\u8F7D\u6B21\u6570 "+e._s(this.appInfo.totalDownloadCount||0))]),t("div",{staticClass:"downloadCount"})]),t("div",{staticClass:"todayWrapper"},[e._m(2),t("p",{domProps:{innerHTML:e._s(e.getTodayCount())}}),t("div",{staticClass:"downloadCount"})])]),this.showEditorVersion?t("editorVersion",{attrs:{versionInfo:this.versionInfo,appInfo:this.appInfo},on:{cancel:e.cancel,updateSuccess:e.updateSuccess}}):e._e()],1)},H=[function(){var a=this,e=a.$createElement,o=a._self._c||e;return o("div",{staticClass:"header-content-top"},[o("div",{staticClass:"top-left"},[o("span",{staticClass:"el-icon-tickets",staticStyle:{"margin-right":"6px"}}),a._v("\u7248\u672C\u4FE1\u606F ")])])},function(){var a=this,e=a.$createElement,o=a._self._c||e;return o("div",{staticClass:"downloadWrapper"},[o("i",{staticClass:"icon-ic_download_s"})])},function(){var a=this,e=a.$createElement,o=a._self._c||e;return o("div",{staticClass:"downloadWrapper"},[o("i",{staticClass:"icon-ic_download_s"})])}];const O={props:{appInfo:{type:Object},subTitleArr:{type:Array}},components:{EditorVersion:_,VueQr:v},data(){return{headerOperationData:["Bundle ID","\u4E0B\u8F7D\u5730\u5740","App Key"],dataArr:[],showEditorVersion:!1,versionInfo:{}}},computed:{},created(){this.$nextTick(()=>{this.getAppVersionListData()}),this.bus.$on("uploadSuccess",()=>{this.getAppVersionListData()})},destroyed(){this.bus.$off("uploadSuccess")},methods:{getAppVersionListData(){C(this.appInfo._id,this.currentPage).then(a=>{console.log("VersionList",a.data),this.dataArr=a.data},a=>{})},clickDownLoad(a){const e=document.createElement("a");let o=a.downloadUrl;e.setAttribute("href",o),e.click(),fetch(o).then(t=>{let i=t.body.getReader(),n=t.headers.get("Content-Length"),r=0;i.read().then(function m(p){if(p.done){console.log("\u4E0B\u8F7D\u5B8C\u6210"),A(a._id).then(()=>{},Z=>{});return}return r+=p.value.length,console.log(`progress: ${r/n*100}%`),i.read().then(m)})})},clickEditor(a){this.showEditorVersion=!0,a.appName=this.appInfo.appName,this.versionInfo=a},clickPreview(a){const{href:e}=this.$router.resolve({name:"AppPreView",path:"/",params:{id:this.appInfo.shortUrl}});window.open(e,"_blank")},clickDelete(a){this.$confirm("\u786E\u8BA4\u5220\u9664\uFF1F").then(()=>{$(this.appInfo._id,a._id).then(e=>{this.$message.success("\u5220\u9664\u6210\u529F");let o=this.dataArr.indexOf(a);this.dataArr.splice(o,1),console.log(this.dataArr)},e=>{this.$message.error(e)})}).catch(()=>{})},releaseApp(a){if(!a.versionName&&!a.appVersion){this.clickEditor(a);return}k(this.appInfo._id,a._id,!0).then(e=>{this.$message.success(e.message),this.appInfo.releaseVersionId=a._id,this.getAppVersionListData()},e=>{})},getCreatTime(a){return new Date(a).toFormat()},getUpdateMode(a){return a=="normal"?"\u666E\u901A\u66F4\u65B0":a=="silent"?"\u9759\u9ED8\u66F4\u65B0":"\u5F3A\u5236\u66F4\u65B0"},getAppSize(a){return`${(a/1024/1024).toFixed(2)}M`},getDownLoadCount(a){return a||0},getAllowDownLoadCount(a){return a.grayScaleLimit?`${a.downloadCount}/${a.grayScaleSize}`:`${a.downloadCount}/\u4E0D\u9650`},cancel(){this.showEditorVersion=!1},updateSuccess(){this.$emit("updateAppInfoSuccess"),this.showEditorVersion=!1,this.getAppVersionListData()},getIconClass(a){return a.active?a.grayScaleLimit&&a.downloadCount>=a.grayScaleSize?"version-table-one-gray":"version-table-one-lighting":"version-table-one-gray"},getTodayCount(){return this.appInfo.todayDownloadCount&&new Date(this.appInfo.todayDownloadCount.date).toDateString()===new Date().toDateString()?`\u4ECA\u65E5\u4E0B\u8F7D\u6B21\u6570  ${this.appInfo.todayDownloadCount.count}`:"\u4ECA\u65E5\u4E0B\u8F7D\u6B21\u6570  0"},getVersion(a){return a.versionName?`${a.versionName}(${a.versionCode})`:a.appVersion||"-"}}},f={};var R=l(O,W,H,!1,q,null,null,null);function q(a){for(let e in f)this[e]=f[e]}var K=function(){return R.exports}(),Q=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("appDetailHeader",{directives:[{name:"show",rawName:"v-show",value:this.appInfo._id,expression:"this.appInfo._id"}],attrs:{appInfo:this.appInfo},on:{updateAppInfoSuccess:e.updateAppInfoSuccess}}),e.appInfo._id?t("appVersions",{directives:[{name:"show",rawName:"v-show",value:!e.showAppSetting,expression:"!showAppSetting"}],attrs:{appInfo:e.appInfo,subTitleArr:e.subTitleArr},on:{updateAppInfoSuccess:e.updateAppInfoSuccess}}):e._e(),e.showAppSetting?t("appSetting",{attrs:{appInfo:e.appInfo}}):e._e()],1)},G=[];const J={data(){return{subTitleArr:["","",""],appInfo:{},showAppSetting:!1,curApp:c.getCurApp()}},components:{AppDetailHeader:F,AppVersions:K,AppSetting:L},computed:{},destroyed(){this.bus.$off("appSummary"),this.bus.$off("appSetting")},created(){this.$nextTick(()=>{this.getAppDetailData()}),this.bus.$on("appSummary",()=>{this.showAppSetting=!1}),this.bus.$on("appSetting",()=>{this.showAppSetting=!0})},methods:{getAppDetailData(){this.curApp=c.getCurApp(),x(this.curApp._id).then(a=>{console.log(a),this.appInfo=a.data,this.subTitleArr=[],this.subTitleArr.push(this.appInfo.bundleId),this.subTitleArr.push(window.location.origin+"/"+this.appInfo.shortUrl),this.subTitleArr.push(this.appInfo._id),this.bus.$emit("appdetail",a.data.appName)},a=>{})},updateAppInfoSuccess(){this.getAppDetailData()}}},h={};var X=l(J,Q,G,!1,Y,null,null,null);function Y(a){for(let e in h)this[e]=h[e]}var oe=function(){return X.exports}();export{oe as default};
