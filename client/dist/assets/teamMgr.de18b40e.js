import{p as z,q as V,s as B,m as F,o as W,n as L,f as U,t as k,w as R,x as X,y as G,z as Y,A as D}from"./index.4d4590a9.js";import{r as H}from"./loginApi.76ad5b0f.js";function Q(n){let e=`api/collaborator/${n}/members`;return z(e)}function J(n,e){let a={emailList:e,role:"guest"},t=`api/collaborator/${n}/invite`;return V(t,a)}function K(n,e){let a=`api/collaborator/${n}/member/${e}`;return B(a)}function Z(n,e,a){let t=`api/collaborator/${n}/role`;return V(t,{memberId:e,role:a})}var j={exports:{}};(function(n,e){(function(a,t){n.exports=t()})(F,function(){return function(a){function t(s){if(i[s])return i[s].exports;var l=i[s]={i:s,l:!1,exports:{}};return a[s].call(l.exports,l,l.exports,t),l.l=!0,l.exports}var i={};return t.m=a,t.c=i,t.i=function(s){return s},t.d=function(s,l,u){t.o(s,l)||Object.defineProperty(s,l,{configurable:!1,enumerable:!0,get:u})},t.n=function(s){var l=s&&s.__esModule?function(){return s.default}:function(){return s};return t.d(l,"a",l),l},t.o=function(s,l){return Object.prototype.hasOwnProperty.call(s,l)},t.p=".",t(t.s=10)}([function(a,t,i){i(7);var s=i(5)(i(2),i(6),null,null);a.exports=s.exports},function(a,t,i){a.exports=function(s){function l(o){o.preventDefault(),typeof s=="function"&&s(o)}function u(o){o.keyCode===27&&l(o)}var r=!1;return{get isListening(){return r},start:function(o){window.addEventListener("click",l,!0),window.addEventListener("keyup",u,!0),r=!0,typeof o=="function"&&o()},stop:function(o){window.removeEventListener("click",l,!0),window.removeEventListener("keyup",u,!0),r=!1,typeof o=="function"&&o()}}}},function(a,t,i){function s(r){return r&&r.__esModule?r:{default:r}}Object.defineProperty(t,"__esModule",{value:!0});var l=i(1),u=s(l);t.default={name:"context-menu",props:{id:{type:String,default:"default-ctx"}},data:function(){var r=this;return{locals:{},align:"left",ctxTop:0,ctxLeft:0,ctxVisible:!1,bodyClickListener:(0,u.default)(function(o){var v=!!r.ctxVisible,p=v&&!r.$el.contains(o.target);if(p){if(o.which!==1)return o.preventDefault(),o.stopPropagation(),!1;r.ctxVisible=!1,r.$emit("ctx-cancel",r.locals),o.stopPropagation()}else r.ctxVisible=!1,r.$emit("ctx-close",r.locals)})}},methods:{setPositionFromEvent:function(r){var o=this;r=r||window.event;var v=document.scrollingElement||document.documentElement;return r.pageX||r.pageY?(this.ctxLeft=r.pageX,this.ctxTop=r.pageY-v.scrollTop):(r.clientX||r.clientY)&&(this.ctxLeft=r.clientX+v.scrollLeft,this.ctxTop=r.clientY+v.scrollTop),this.$nextTick(function(){var p=o.$el,_=(p.style.minHeight||p.style.height).replace("px","")||32,x=(p.style.minWidth||p.style.width).replace("px","")||32,w=p.scrollHeight||_,$=p.scrollWidth||x,C=window.innerHeight-w-25,A=window.innerWidth-$-25;o.ctxTop>C&&(o.ctxTop=C),o.ctxLeft>A&&(o.ctxLeft=A)}),r},open:function(r,o){return this.ctxVisible&&(this.ctxVisible=!1),this.ctxVisible=!0,this.$emit("ctx-open",this.locals=o||{}),this.setPositionFromEvent(r),this.$el.setAttribute("tab-index",-1),this.bodyClickListener.start(),this}},watch:{ctxVisible:function(r,o){o===!0&&r===!1&&this.bodyClickListener.stop(function(v){})}},computed:{ctxStyle:function(){return{display:this.ctxVisible?"block":"none",top:(this.ctxTop||0)+"px",left:(this.ctxLeft||0)+"px"}}}}},function(a,t,i){t=a.exports=i(4)(void 0),t.push([a.i,'.ctx{position:relative}.ctx-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:160px;padding:5px 0;margin:2px 0 0;font-size:.9rem;color:#373a3c;text-align:left;list-style:none;background-color:#fff;-webkit-background-clip:padding-box;background-clip:padding-box;border:1px solid rgba(0,0,0,.15);border-radius:.25rem;-moz-box-shadow:0 0 5px #ccc;-webkit-box-shadow:0 0 5px #ccc;box-shadow:0 0 5px #ccc}.ctx-divider{height:1px;margin:.5rem 0;overflow:hidden;background-color:#e5e5e5}.ctx-item{display:block;padding:3px 20px;clear:both;font-weight:400;line-height:1.5;color:#373a3c;text-align:inherit;white-space:nowrap;background:none;border:0;cursor:default}.ctx-item:focus,.ctx-item:hover{color:#2b2d2f;text-decoration:none;background-color:#f5f5f5;cursor:normal}.ctx-item.active,.ctx-item.active:focus,.ctx-item.active:hover{color:#fff;text-decoration:none;background-color:#0275d8;outline:0}.ctx-item.disabled,.ctx-item.disabled:focus,.ctx-item.disabled:hover{color:#818a91}.ctx-item.disabled:focus,.ctx-item.disabled:hover{text-decoration:none;cursor:not-allowed;background-color:transparent;background-image:none;filter:"progid:DXImageTransform.Microsoft.gradient(enabled = false)"}.open>.ctx-menu{display:block}.open>a{outline:0}.ctx-menu-right{right:0;left:auto}.ctx-menu-left{right:auto;left:0}.ctx-header{display:block;padding:3px 20px;font-size:.9rem;line-height:1.5;color:#818a91;white-space:nowrap}.ctx-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:990}.pull-right>.ctx-menu{right:0;left:auto}.ctx-menu-container{position:fixed;padding:0;border:1px solid #bbb;background-color:#f5f5f5;z-index:99999;box-shadow:0 5px 11px 0 rgba(0,0,0,.18),0 4px 15px 0 rgba(0,0,0,.15)}',""])},function(a,t){function i(l,u){var r=l[1]||"",o=l[3];if(!o)return r;if(u&&typeof btoa=="function"){var v=s(o),p=o.sources.map(function(_){return"/*# sourceURL="+o.sourceRoot+_+" */"});return[r].concat(p).concat([v]).join(`
`)}return[r].join(`
`)}function s(l){var u=btoa(unescape(encodeURIComponent(JSON.stringify(l)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,"+u;return"/*# "+r+" */"}a.exports=function(l){var u=[];return u.toString=function(){return this.map(function(r){var o=i(r,l);return r[2]?"@media "+r[2]+"{"+o+"}":o}).join("")},u.i=function(r,o){typeof r=="string"&&(r=[[null,r,""]]);for(var v={},p=0;p<this.length;p++){var _=this[p][0];typeof _=="number"&&(v[_]=!0)}for(p=0;p<r.length;p++){var x=r[p];typeof x[0]=="number"&&v[x[0]]||(o&&!x[2]?x[2]=o:o&&(x[2]="("+x[2]+") and ("+o+")"),u.push(x))}},u}},function(a,t){a.exports=function(i,s,l,u){var r,o=i=i||{},v=typeof i.default;v!=="object"&&v!=="function"||(r=i,o=i.default);var p=typeof o=="function"?o.options:o;if(s&&(p.render=s.render,p.staticRenderFns=s.staticRenderFns),l&&(p._scopeId=l),u){var _=p.computed||(p.computed={});Object.keys(u).forEach(function(x){var w=u[x];_[x]=function(){return w}})}return{esModule:r,exports:o,options:p}}},function(a,t){a.exports={render:function(){var i=this,s=i.$createElement,l=i._self._c||s;return l("div",{ref:"contextMenu",staticClass:"ctx-menu-container",style:i.ctxStyle,attrs:{id:i.id},on:{click:function(u){u.stopPropagation()},contextmenu:function(u){u.stopPropagation()}}},[l("div",{staticClass:"ctx open",staticStyle:{"background-color":"transparent"}},[l("ul",{staticClass:"ctx-menu",class:{"ctx-menu-right":i.align==="right","ctx-menu-left":i.align==="left"},attrs:{role:"menu"}},[i._t("default")],2)])])},staticRenderFns:[]}},function(a,t,i){var s=i(3);typeof s=="string"&&(s=[[a.i,s,""]]),s.locals&&(a.exports=s.locals),i(8)("0df30a58",s,!0)},function(a,t,i){function s(c){for(var h=0;h<c.length;h++){var m=c[h],d=_[m.id];if(d){d.refs++;for(var f=0;f<d.parts.length;f++)d.parts[f](m.parts[f]);for(;f<m.parts.length;f++)d.parts.push(u(m.parts[f]));d.parts.length>m.parts.length&&(d.parts.length=m.parts.length)}else{for(var b=[],f=0;f<m.parts.length;f++)b.push(u(m.parts[f]));_[m.id]={id:m.id,refs:1,parts:b}}}}function p(c,h){for(var m=[],d={},f=0;f<h.length;f++){var b=h[f],g=b[0],I=b[1],y=b[2],M=b[3],S={css:I,media:y,sourceMap:M};d[g]?(S.id=c+":"+d[g].parts.length,d[g].parts.push(S)):(S.id=c+":0",m.push(d[g]={id:g,parts:[S]}))}return m}function l(){var c=document.createElement("style");return c.type="text/css",x.appendChild(c),c}function u(c){var h,m,d=document.querySelector('style[data-vue-ssr-id~="'+c.id+'"]'),f=d!=null;if(f&&C)return A;if(O){var b=$++;d=w||(w=l()),h=r.bind(null,d,b,!1),m=r.bind(null,d,b,!0)}else d=d||l(),h=o.bind(null,d),m=function(){d.parentNode.removeChild(d)};return f||h(c),function(g){if(g){if(g.css===c.css&&g.media===c.media&&g.sourceMap===c.sourceMap)return;h(c=g)}else m()}}function r(c,h,m,d){var f=m?"":d.css;if(c.styleSheet)c.styleSheet.cssText=N(h,f);else{var b=document.createTextNode(f),g=c.childNodes;g[h]&&c.removeChild(g[h]),g.length?c.insertBefore(b,g[h]):c.appendChild(b)}}function o(c,h){var m=h.css,d=h.media,f=h.sourceMap;if(d&&c.setAttribute("media",d),f&&(m+=`
/*# sourceURL=`+f.sources[0]+" */",m+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(f))))+" */"),c.styleSheet)c.styleSheet.cssText=m;else{for(;c.firstChild;)c.removeChild(c.firstChild);c.appendChild(document.createTextNode(m))}}var v=typeof document!="undefined";if(typeof DEBUG!="undefined"&&DEBUG&&!v)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var p=i(9),_={},x=v&&(document.head||document.getElementsByTagName("head")[0]),w=null,$=0,C=!1,A=function(){},O=typeof navigator!="undefined"&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());a.exports=function(c,h,m){C=m;var d=p(c,h);return s(d),function(f){for(var b=[],g=0;g<d.length;g++){var I=d[g],y=_[I.id];y.refs--,b.push(y)}f?(d=p(c,f),s(d)):d=[];for(var g=0;g<b.length;g++){var y=b[g];if(y.refs===0){for(var M=0;M<y.parts.length;M++)y.parts[M]();delete _[y.id]}}}};var N=function(){var c=[];return function(h,m){return c[h]=m,c.filter(Boolean).join(`
`)}}()},function(a,t){a.exports=function(i,s){for(var l=[],u={},r=0;r<s.length;r++){var o=s[r],v=o[0],p=o[1],_=o[2],x=o[3],w={id:i+":"+r,css:p,media:_,sourceMap:x};u[v]?u[v].parts.push(w):l.push(u[v]={id:v,parts:[w]})}return l}},function(a,t,i){var s=i(0);s.install=function(l){var u=l.component("context-menu",s);return u},window.VueContextMenu=s,a.exports=a.exports.default=s}])})})(j);var q=W(j.exports),ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAICAYAAAAvOAWIAAAAAXNSR0IArs4c6QAAAMpJREFUGBltjjEKwkAQRXc2S6LYWXgFBRU9gYWQI5hLaJVerNLaCB4iJ1ALCxF77Sy8gL2Iu+6MO5EEQ/zFDP/9v8OCcEp3l5X0vBlay7YkpZSw1q4nYX8qiQhc2mP4T+6IQMIOZxIASADOjTEPKb1Snz1zALXIyjyicHgUghKlyuWvpyQKuy53l3mwGrq21NpsfT/IPG/2zDPgBv+3ULo/t6WVBz+ot/TreUcPR9F4cM0LxWUGHBBSjAJvhO/4t5g/qOx0c2pWoAMfw1VIWiEuEbsAAAAASUVORK5CYII=",te=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"teamItem"},[t("div",[t("div",{staticClass:"teamItem-circle",class:e.color},[e._v(e._s(e.lastName))]),t("label",{staticClass:"teamItem-name"},[e._v(e._s(e.value.username))]),t("div",{staticClass:"teamItem-email"},[e._v("| "+e._s(e.value.email))])]),t("div",{staticClass:"teamItem-owner",on:{click:function(s){return s.stopPropagation(),e.roleAction.apply(null,arguments)}}},[t("label",[e._v(e._s(e.ownerString))]),t("img",{directives:[{name:"show",rawName:"v-show",value:e.isRole,expression:"isRole"}],staticClass:"teamItem-owner-img",style:e.iconStyle,attrs:{src:ee}})]),t("context-menu",{ref:"ctxMenu",staticClass:"ctx-menu",on:{"ctx-cancel":e.onCtxClose,"ctx-close":e.onCtxClose}},[e.isManager||!e.isSelf?t("li",{staticClass:"ctx-item",on:{click:e.setRoleToManager}},[e._v("\u7BA1\u7406\u5458")]):e._e(),e.isManager||!e.isSelf?t("li",{staticClass:"ctx-item",on:{click:e.setRoleToGuest}},[e._v("\u56F4\u89C2\u7FA4\u4F17")]):e._e(),t("li",{staticClass:"ctx-item menu-item",on:{click:e.selected}},[e._v(e._s(e.lastItem))])])],1)},se=[];const ie={props:{value:Object,isManager:!1,index:Number},data(){return{color:"header-background-red",isRole:!0,rotate:!1,isSelf:!1,showMenu:!1,align:"left"}},created(){this.valueChanged()},methods:{selected(){this.$emit("select",this.index),this.showMenu=!1},roleAction(){this.isRole&&(this.rotate=!this.rotate,this.$refs.ctxMenu.open(),this.showMenu=!0)},setRoleToManager(){this.roleModify("manager"),this.showMenu=!1},setRoleToGuest(){this.roleModify("guest"),this.showMenu=!1},roleModify(n){let e=this.value.uid,a=n;Z(U.getCurApp()._id,e,a).then(t=>{this.$message({message:t.message,type:t.success?"success":"error"}),this.$emit("roleUpdate")})},onCtxClose(){this.showMenu=!1},valueChanged(){let n=Math.floor(Math.random()*Math.floor(4));console.log(this.value),console.log(k()),this.isSelf=k()===this.value.uid,this.isRole=(this.isManager||this.isSelf)&&this.value.role!=="owner",this.color=["header-background-red","header-background-green","header-background-orange","header-background-purple"][n]}},computed:{lastName(){let n=this.value.username.length;return this.value.username.substring(n-1)},ownerString(){switch(this.value.role){case"owner":return"\u521B\u5EFA\u8005";case"manager":return"\u7BA1\u7406\u5458";default:return"\u56F4\u89C2\u7FA4\u4F17"}},lastItem(){return this.isSelf?"\u79BB\u5F00\u8BE5\u56E2\u961F":"\u79FB\u9664\u8BE5\u961F\u5458"},iconStyle(){return this.showMenu?{transform:"rotate(180deg)"}:{transform:"rotate(0deg)"}}},watch:{value(){this.valueChanged()}},components:{contextMenu:q}},E={};var re=L(ie,te,se,!1,ne,null,null,null);function ne(n){for(let e in E)this[e]=E[e]}var oe=function(){return re.exports}(),ae=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"teamItem"},[t("div",[t("div",{staticClass:"teamItem-circle",class:e.color},[e._v(e._s(e.lastName))]),t("label",{staticClass:"teamItem-name"},[e._v(e._s(e.account.username))]),t("div",{staticClass:"teamItem-email"},[e._v("| "+e._s(e.account.email))])]),e.account.permission!="root"?t("div",{staticClass:"right"},[t("el-button",{attrs:{type:"info",plain:""},on:{click:e.resetPassword}},[e._v("\u91CD\u7F6E\u5BC6\u7801")]),t("el-button",{attrs:{type:"danger",plain:""},on:{click:e.deleteAccount}},[e._v("\u6CE8\u9500\u8D26\u53F7")])],1):e._e(),e.account.permission=="root"?t("div",{staticClass:"right"},[e._v("\u8D85\u7EA7\u7BA1\u7406\u5458")]):e._e()])},le=[];const ce={props:{account:Object},data(){return{color:"header-background-red"}},methods:{resetPassword(){this.$emit("resetPassword")},deleteAccount(){this.$emit("deleteAccount")}},computed:{lastName(){let n=this.account.username.length;return this.account.username.substring(n-1)}}},P={};var ue=L(ce,ae,le,!1,de,null,null,null);function de(n){for(let e in P)this[e]=P[e]}var pe=function(){return ue.exports}(),me=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"teamMgr"},[t("div",{staticClass:"header"},[t("div",{staticClass:"right"},[t("el-button",{attrs:{type:"primary"},on:{click:e.addClick}},[e._v(" \u6DFB\u52A0\u65B0\u6210\u5458 ")]),e.user.permission=="root"?t("el-button",{attrs:{type:"primary",plain:""},on:{click:e.registerClick}},[e._v(" \u6CE8\u518C\u65B0\u8D26\u53F7 ")]):e._e()],1)]),t("el-tabs",{staticClass:"card"},[t("el-tab-pane",[t("span",{attrs:{slot:"label"},slot:"label"},[e._v("\u9879\u76EE\u6210\u5458")]),t("div",{staticClass:"teamMgr-collection"},[t("div",{staticClass:"teamMgr-content"},[e._l(e.members,function(i,s){return t("item",{key:s,attrs:{"is-manager":e.isOwner,index:s},on:{select:e.itemSelected,roleUpdate:e.requestMembers},model:{value:e.members[s],callback:function(u){e.$set(e.members,s,u)},expression:"members[index]"}})}),t("div",{staticClass:"teamMgr-group-footer"},[t("div",[e._v(" \u5171 "+e._s(e.members.length)+" \u540D\u6210\u5458")])]),t("div",{staticClass:"teamMgr-group-bottom"})],2)])]),e.user.permission=="root"?t("el-tab-pane",[t("span",{attrs:{slot:"label"},slot:"label"},[e._v("\u8D26\u53F7\u7BA1\u7406")]),t("div",{staticClass:"teamMgr-collection"},[t("div",{staticClass:"teamMgr-content"},[e._l(e.accounts,function(i,s){return t("member-item",{key:s,attrs:{index:s,account:i},on:{deleteAccount:function(u){return e.deleteAccount(i)},resetPassword:function(u){return e.resetPassword(i)}}})}),t("div",{staticClass:"teamMgr-group-footer"},[t("div",[e._v(" \u5171 "+e._s(e.accounts.length)+" \u540D\u6210\u5458")])]),t("div",{staticClass:"teamMgr-group-bottom"})],2)])]):e._e()],1),t("el-dialog",{attrs:{title:"\u91CD\u7F6E\u5BC6\u7801",visible:e.isShowResetPassword,width:"30%","append-to-body":!0,center:""},on:{"update:visible":function(s){e.isShowResetPassword=s}}},[t("div",[t("p",{staticStyle:{"margin-bottom":"20px","font-size":"16px"}},[e._v(e._s(this.account.username))]),t("el-input",{staticClass:"user-login-form-input",attrs:{type:"text",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","prefix-icon":"icon-ic_pswd"},model:{value:e.newPassword,callback:function(s){e.newPassword=s},expression:"newPassword"}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(s){e.isShowResetPassword=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{loading:e.showLoading,type:"primary"},on:{click:e.resetPasswordRequest}},[e._v("\u786E \u5B9A")])],1)]),t("el-dialog",{staticClass:"dialog-register",attrs:{title:"\u6CE8\u518C\u65B0\u8D26\u53F7",visible:e.isShowRegister,width:"30%","append-to-body":!0,center:""},on:{"update:visible":function(s){e.isShowRegister=s}}},[t("div",{staticClass:"user-register-form"},[t("el-input",{staticClass:"user-login-form-input",attrs:{type:"text",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D","prefix-icon":"icon-ic_name"},model:{value:e.username,callback:function(s){e.username=s},expression:"username"}}),t("el-input",{staticClass:"user-login-form-input",staticStyle:{"margin-top":"24px"},attrs:{placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",type:"email","prefix-icon":"icon-ic_email"},model:{value:e.email,callback:function(s){e.email=s},expression:"email"}}),t("el-input",{staticClass:"user-login-form-input",staticStyle:{"margin-top":"24px"},attrs:{placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",type:"password","prefix-icon":"icon-ic_pswd"},model:{value:e.password,callback:function(s){e.password=s},expression:"password"}})],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(s){e.isShowRegister=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{loading:e.showLoading,type:"primary"},on:{click:e.sendRegister}},[e._v("\u786E \u5B9A")])],1)]),t("el-dialog",{attrs:{title:"\u9080\u8BF7\u6210\u5458",visible:e.isShowInvite,width:"30%","append-to-body":!0,center:""},on:{"update:visible":function(s){e.isShowInvite=s}}},[t("el-input",{attrs:{placeholder:"\u591A\u4E2A\u90AE\u7BB1\u4F7F\u7528\u7A7A\u683C\u5206\u5F00",rows:10,type:"textarea"},model:{value:e.invitedEmails,callback:function(s){e.invitedEmails=s},expression:"invitedEmails"}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(s){e.isShowInvite=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{type:"primary"},on:{click:e.sendInvite}},[e._v("\u786E \u5B9A")])],1)],1),t("el-dialog",{attrs:{title:"\u63D0\u793A",visible:e.dialogVisible,"append-to-body":!0,width:"30%"},on:{"update:visible":function(s){e.dialogVisible=s}}},[t("span",[e._v(e._s(e.message))]),e.isManager?t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(s){e.dialogVisible=!1}}},[e._v("\u53D6 \u6D88")]),t("el-button",{attrs:{type:"primary"},on:{click:e.deleteMember}},[e._v("\u786E \u5B9A")])],1):e._e()])],1)},fe=[];const he={data(){return{members:[],accounts:[],isShowRegister:!1,isShowResetPassword:!1,isShowInvite:!1,dialogVisible:!1,isManager:!1,currentIndex:-1,message:"",invitedEmails:"",isOwner:!1,dissolveShow:!1,createTeamVisible:!1,username:"",password:"",email:"",showLoading:!1,form:{name:""},account:{},newPassword:"",curApp:U.getCurApp(),user:R()}},mounted(){this.user=R(),this.requestMembers(),this.bus.$on("refreshList",()=>{this.requestMembers()}),this.user.permission=="root"&&(this.requestAccounts(),this.bus.$on("refreshAccounts",()=>{this.requestAccounts()}))},destroyed(){this.bus.$off("refreshList")},computed:{},methods:{showMenu(){this.$refs.ctxMenu.open()},addClick(){this.isShowInvite=!0},registerClick(){this.isShowRegister=!0},sendRegister(){if(this.username.length===0){this.$message.error("\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A");return}if(this.email.length===0){this.$message.error("\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A");return}if(!X.valideEmail(this.email)){this.$message.error("\u90AE\u7BB1\u683C\u5F0F\u9519\u8BEF");return}if(this.password.length===0){this.$message.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}let n={username:this.username,password:this.password,email:this.email};this.showLoading=!0,H(n).then(e=>{this.showLoading=!1,console.log(e),this.$message({message:"\u6CE8\u518C\u6210\u529F",type:"success"}),setTimeout(()=>{this.requestAccounts()},500)},e=>{this.showLoading=!1})},sendInvite(){this.isShowInvite=!1;let n=this.invitedEmails.split(" "),e=[];for(var a of n)if(this.checkEmail(a)){var t=a.replace(/[\r\n]/g,"");e.push(t)}e.length>0?this.request(e):this.$message.error("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1"),console.log(e)},itemSelected(n){this.currentIndex=n;let e=k(),a=this.members[this.currentIndex].uid,t=this.members.filter(i=>i.uid===k())[0].role;(e!==a||t!=="owner")&&(this.stateUpdate(),this.dialogVisible=!0)},deleteMember(){if(this.dialogVisible=!1,this.currentIndex>=0){let n=this.members[this.currentIndex].uid;K(this.curApp._id,n).then(e=>{this.$message({message:e.message,type:e.success?"success":"error"}),e.success&&this.requestMembers()})}},stateUpdate(){if(this.currentIndex>=0){this.user=R();let n=this.members.filter(t=>t.uid===this.user._id)[0].role,e=this.members[this.currentIndex].username,a=k()===this.members[this.currentIndex].uid;switch(n){case"owner":this.message="\u786E\u5B9A\u8981\u79FB\u9664"+e+"\u5417?",this.isManager=!0;break;case"manager":this.message="\u786E\u5B9A\u8981\u79FB\u9664"+e+"\u5417?",this.isManager=!0;break;default:this.message=a?"\u786E\u5B9A\u8981\u79BB\u5F00\u8BE5\u56E2\u961F\u5417?":"\u56F4\u89C2\u7FA4\u4F17\u6743\u9650\u65E0\u6CD5\u4F7F\u7528\u8BE5\u529F\u80FD\uFF0C\u53EF\u8054\u7CFB\u9879\u76EE\u521B\u5EFA\u8005\u4FEE\u6539\u6743\u9650\u54E6",this.isManager=a;break}}},deleteAccount(n){this.$confirm(`\u786E\u8BA4\u6CE8\u9500${n.username}\uFF1F`).then(()=>{G(n._id).then(e=>{this.$message.success("\u6CE8\u9500\u6210\u529F"),this.requestAccounts()},e=>{this.$message.error(e)})}).catch(()=>{})},resetPassword(n){this.account=n,this.isShowResetPassword=!0},resetPasswordRequest(){this.showLoading=!0,Y(this.account._id,this.newPassword).then(n=>{this.$message.success("\u91CD\u7F6E\u6210\u529F"),this.showLoading=!1,this.isShowResetPassword=!1,this.requestAccounts()},n=>{this.showLoading=!1,this.$message.error(n)})},request(n){J(this.curApp._id,n).then(e=>{e.success&&(this.$message({message:e.message,type:"success"}),this.requestMembers())})},requestMembers(){Q(this.curApp._id).then(n=>{this.members=n.data})},requestAccounts(){D().then(n=>{this.accounts=n.data})},checkEmail(n){return/\S+@\S+\.\S+/.test(n)}},components:{MemberItem:pe,Item:oe,contextMenu:q},directives:{focus:{update(n,{value:e}){e&&n.focus()}}},watch:{members(){let n=this.members.filter(e=>e.uid===k());n&&n.length>0&&(this.isOwner=n[0].role==="owner")}}},T={};var ge=L(he,me,fe,!1,ve,null,null,null);function ve(n){for(let e in T)this[e]=T[e]}var _e=function(){return ge.exports}();export{_e as default};
